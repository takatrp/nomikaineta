# Create the HTML file for the drinking party random topic app
content = r"""<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>é£²ã¿ä¼šãƒã‚¿ãƒ»ãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤º</title>
<style>
  :root{
    --bg:#0f172a;       /* slate-900 */
    --card:#111827;     /* gray-900 */
    --ink:#e5e7eb;      /* gray-200 */
    --muted:#94a3b8;    /* slate-400 */
    --accent:#3b82f6;   /* blue-500 */
    --accent-2:#60a5fa; /* blue-400 */
    --ok:#22c55e;       /* green-500 */
    --warn:#f59e0b;     /* amber-500 */
  }
  html,body{height:100%;}
  body{
    margin:0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", "Yu Gothic UI", "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
    color:var(--ink);
    background: radial-gradient(1200px 800px at 30% -10%, #1f2937, transparent), var(--bg);
    letter-spacing: .02em;
  }
  .wrap{max-width:980px;margin:0 auto;padding:24px 16px 56px;}
  header h1{font-size: clamp(20px, 3vw, 28px); margin:0 0 4px;}
  header p{margin:6px 0 16px;color:var(--muted);font-size:14px}
  .panel{
    background: linear-gradient(180deg, rgba(59,130,246,.12), rgba(59,130,246,.05));
    border:1px solid rgba(59,130,246,.25);
    border-radius:14px;
    padding:14px;
    display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;
  }
  .seg{
    display:inline-flex;border:1px solid rgba(148,163,184,.35);border-radius:999px;overflow:hidden;
  }
  .seg input{display:none}
  .seg label{
    padding:8px 14px;cursor:pointer;font-weight:600;color:var(--muted);user-select:none;
    background:transparent; transition:.2s ease;
  }
  .seg input:checked + label{background:var(--accent);color:white}
  .btns{display:flex;gap:10px;flex-wrap:wrap}
  button{
    appearance:none;border:none;cursor:pointer;
    background:var(--accent);color:white;border-radius:10px;
    padding:12px 16px;font-weight:700;font-size:16px;
    box-shadow: 0 8px 24px rgba(59,130,246,.25);
    transition: transform .04s ease, box-shadow .2s ease, opacity .2s ease;
  }
  button:active{transform: translateY(1px);}
  button.secondary{background:#1f2937;color:var(--ink);border:1px solid rgba(148,163,184,.35);box-shadow:none}
  button.ghost{background:transparent;color:var(--muted);border:1px dashed rgba(148,163,184,.35);box-shadow:none}
  .grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:16px}
  .card{
    background: linear-gradient(180deg, rgba(17,24,39,.9), rgba(15,23,42,.9));
    border:1px solid rgba(148,163,184,.2);
    border-radius:14px;padding:18px 16px;
  }
  .topic{font-size: clamp(22px, 5vw, 34px); font-weight:900; line-height:1.3; margin:4px 0 6px;
    text-shadow: 0 12px 28px rgba(0,0,0,.45);
    letter-spacing:.02em
  }
  .meta{display:flex;align-items:center;gap:10px;color:var(--muted);font-size:13px;margin-bottom:8px}
  .tag{
    display:inline-flex;align-items:center;gap:6px;
    background: rgba(59,130,246,.15); color:#bfdbfe; border:1px solid rgba(59,130,246,.35);
    border-radius:999px; padding:6px 10px; font-weight:700; font-size:12px;
  }
  ul.follow{margin:10px 0 0 20px;padding:0}
  ul.follow li{margin:6px 0;color:#dbeafe}
  details{background:transparent;border:1px solid rgba(148,163,184,.25);border-radius:12px;padding:10px 12px}
  details summary{cursor:pointer;color:var(--muted);font-weight:700}
  ol#history{margin-top:8px;padding-left:20px}
  .hint{color:var(--muted);font-size:12px}
  .toast{
    position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
    background:#0b1220;border:1px solid rgba(148,163,184,.3);color:#e2e8f0;
    padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none; transition:opacity .25s ease;
  }
  .toast.show{opacity:1}
  .roll{animation: roll 600ms ease}
  @keyframes roll{
    0%{filter:blur(10px);opacity:.4;transform:scale(.98) translateY(6px)}
    100%{filter:blur(0);opacity:1;transform:scale(1) translateY(0)}
  }
  footer{margin-top:16px;color:var(--muted);font-size:12px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>é£²ã¿ä¼šãƒã‚¿ãƒ»ãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤º</h1>
      <p>ã€Œæ¬¡ã®ãƒã‚¿ã€ã‚’æŠ¼ã™ã ã‘ã€‚<span class="hint">å®Ÿåãƒ»å¹´åãƒ»æ”¿æ²»/å®—æ•™ãƒ»å®¹å§¿ã„ã˜ã‚Šã¯é¿ã‘ã€ã¿ã‚“ãªãŒå®‰å¿ƒã—ã¦ç¬‘ãˆã‚‹è©±é¡Œã«ã—ã¾ã—ã‚‡ã†ã€‚</span></p>
      <div class="panel">
        <div class="seg" role="tablist" aria-label="ãƒ¢ãƒ¼ãƒ‰é¸æŠ">
          <input type="radio" id="m-mixed" name="mode" value="mixed" checked><label for="m-mixed">ç”·å¥³æ··åˆ</label>
          <input type="radio" id="m-men" name="mode" value="men"><label for="m-men">ç”·æ€§ã®ã¿</label>
        </div>
        <div class="btns">
          <button id="nextBtn" aria-label="æ¬¡ã®ãƒã‚¿">ğŸ² æ¬¡ã®ãƒã‚¿</button>
          <button id="copyBtn" class="secondary" aria-label="ä»Šã®ãƒã‚¿ã‚’ã‚³ãƒ”ãƒ¼">ğŸ“ ã‚³ãƒ”ãƒ¼</button>
          <button id="resetBtn" class="ghost" aria-label="ãƒªã‚»ãƒƒãƒˆ">ğŸ” ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
        </div>
      </div>
    </header>

    <section class="grid">
      <div class="card" aria-live="polite">
        <div class="meta"><span class="tag" id="modeTag">ç”·å¥³æ··åˆ</span><span id="progress" class="hint"></span></div>
        <div id="topic" class="topic">ã‚ˆã†ã“ãï¼ã€Œæ¬¡ã®ãƒã‚¿ã€ã‚’æŠ¼ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆã€‚</div>
        <ul id="followups" class="follow"></ul>
      </div>

      <details>
        <summary>å±¥æ­´ï¼ˆã“ã®å¸­ã§å‡ºã—ãŸãƒã‚¿ï¼‰</summary>
        <ol id="history"></ol>
      </details>

      <footer>
        <div>Â© 2025 é£²ã¿ä¼šãƒã‚¿ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ï½œå®‰å…¨ç¬¬ä¸€ã€‚æ·±é…’ãƒ»ç„¡ç†ãªç…½ã‚Šã¯NGã€‚</div>
      </footer>
    </section>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>
  </div>

<script>
  // ====== ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ ======
  const DATA = {
    mixed: [
      "å­ã©ã‚‚ã®é ƒã«å¥½ãã ã£ãŸçµ¦é£Ÿãƒ»é§„è“å­ã¯ï¼Ÿ",
      "æœ€è¿‘ã„ã¡ã°ã‚“ãƒãƒã£ã¦ã‚‹ãƒ‰ãƒ©ãƒ/ã‚¢ãƒ‹ãƒ¡/YouTubeã¯ï¼Ÿ",
      "ä»Šå¹´è¡Œã£ã¦è‰¯ã‹ã£ãŸãŠåº—ãƒ™ã‚¹ãƒˆ1ï¼ˆã‚¸ãƒ£ãƒ³ãƒ«è‡ªç”±ï¼‰",
      "æ—…è¡Œã®â€œç¬‘ãˆã‚‹å¤±æ•—è«‡â€ï¼ˆæœ¬äººãŒè©±ã—ã¦OKãªç¯„å›²ã§ï¼‰",
      "åœ°å…ƒã ã‘ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ«ãƒ¼ãƒ«ãƒ»æ–¹è¨€ã‚¯ã‚¤ã‚º",
      "æ˜æ—¥ãŒæ€¥ã«ä¸¸ä¸€æ—¥ä¼‘ã¿ãªã‚‰ã€ä½•ã™ã‚‹ï¼Ÿ",
      "æš®ã‚‰ã—ãŒæ¥½ã«ãªã‚‹ã€ç¥ã‚¢ãƒ—ãƒªã€ç´¹ä»‹ä¼š",
      "æœ€è¿‘ã®ã€è²·ã£ã¦ã‚ˆã‹ã£ãŸ/ã‚„ã‚„å¤±æ•—ã€ã‚¢ã‚¤ãƒ†ãƒ ",
      "äººç”Ÿã§ä¸€ç•ªåˆºã•ã£ãŸæœ¬/æ¼«ç”»/è¨˜äº‹ã‚’ä¸€å†Šã ã‘",
      "ã¡ã‚‡ã†ã©ã„ã„ã€ãƒ—ãƒè´…æ²¢ã€ã®å®šç¾©ã‚’èªã‚ã†",
      "å­¦ç”Ÿæ™‚ä»£ã®éƒ¨æ´»ãƒ»ã‚µãƒ¼ã‚¯ãƒ«ã€ã‚ã‚‹ã‚ã‚‹ã€",
      "ä»•äº‹ã§ã€å¬‰ã—ã‹ã£ãŸç¬é–“ã€ï¼ˆå…·ä½“çš„ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ï¼‰",
      "â€œç„¡ç†ã®ãªã„ç¯„å›²ã§â€ãŠé…’ã®å¤±æ•—è«‡",
      "ã‚³ãƒ³ãƒ“ãƒ‹é£¯ã®æœ€å¼·ã‚«ã‚¹ã‚¿ãƒ ã‚’æ±ºã‚ã‚‹ä¼š",
      "è‡ªç”±ã«10ä¸‡å††ä½¿ãˆã‚‹ãªã‚‰ã€ã©ã†ä½¿ã†ï¼Ÿ",
      "é‹/ç„¼è‚‰ã®â€œæµå„€â€ã‚’èªã‚‹ï¼ˆç¶²ã®ä½¿ã„æ–¹ãƒ»ç· ã‚å•é¡Œï¼‰",
      "æœæ´¾ï¼Ÿå¤œæ´¾ï¼Ÿãã‚Œãã‚Œã®æœ€å¼·ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³",
      "ã‚¹ãƒãƒ›ã®ãƒ›ãƒ¼ãƒ ç”»é¢è¦‹ã›åˆã„ï¼ˆã‚¢ãƒ—ãƒªé…ç½®ã®ã‚³ãƒ„ï¼‰",
      "ã“ã“1å¹´ã§ã„ã¡ã°ã‚“ç¬‘ã£ãŸå‡ºæ¥äº‹ã¯ï¼Ÿ",
      "æœ€å¼·ã®é›¨ã®æ—¥ã®éã”ã—æ–¹",
      "æœ€è¿‘ã®å†™çœŸãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰â€œæ¨ã—ã®ä¸€æšâ€ç´¹ä»‹",
      "å¥½ããªè¡—ã¨ãã®ç†ç”±ï¼ˆå›½å†…/æµ·å¤–ï¼‰",
      "ã€ã‚‚ã—ã‚‚åŒã˜ãƒ¡ãƒ³ãƒãƒ¼ã§æ—…ã«å‡ºã‚‹ãªã‚‰ã€è¡Œãå…ˆã¯ï¼Ÿ",
      "ãŸã¾ãŸã¾èº«ã«ã¤ã„ãŸâ€œå½¹ã«ç«‹ã¤ç„¡é§„çŸ¥è­˜â€",
      "å°ã•ã„é ƒã«ä¿¡ã˜ã¦ãŸå‹˜é•ã„/éƒ½å¸‚ä¼èª¬",
      "å­ã©ã‚‚ã®é ƒã¨ä»Šã§â€œå¤‰ã‚ã£ãŸå£ç™–â€ã¯ï¼Ÿ",
      "â€œè‡ªåˆ†ã ã‘ã®â€ç–²åŠ´å›å¾©ãƒ«ãƒ¼ãƒ«",
      "æœ€è¿‘ã‚„ã‚ã¦ã‚ˆã‹ã£ãŸç¿’æ…£/å§‹ã‚ã¦ã‚ˆã‹ã£ãŸç¿’æ…£",
      "ã“ã‚Œã ã‘ã¯äººã«å‹§ã‚ãŸã„å¥åº·ã‚°ãƒƒã‚º/ã‚¹ãƒˆãƒ¬ãƒƒãƒ",
      "æ€ã„å‡ºã®æ ¡æ­Œã‚„CMã‚½ãƒ³ã‚°ã€æ­Œãˆã‚‹ï¼Ÿ",
      "ã¡ã‚‡ã£ã¨ã—ãŸãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã‚²ãƒ¼ãƒ ç´¹ä»‹ï¼ˆãƒ«ãƒ¼ãƒ«ç°¡å˜ãªã‚‚ã®ï¼‰",
      "ã“ã®ä¸€å¹´ã§ä¸€ç•ªã†ã¾ã‹ã£ãŸä¸€çš¿ï¼ˆå†™çœŸãŒã‚ã‚Œã°ãªãŠè‰¯ã—ï¼‰",
      "æ¨ã—ã®ã‚«ãƒ•ã‚§/å–«èŒ¶åº—ã®æ¥½ã—ã¿æ–¹",
      "â€œäººç”Ÿã§ä¸€åº¦ã¯ã‚„ã£ã¦ã¿ãŸã„ä½“é¨“â€ã‚’èªã‚‹",
      "æœ€è¿‘ã®ã€æ°—ã¥ãã€ãƒ™ã‚¹ãƒˆ3ï¼ˆå°ã•ãã¦OKï¼‰",
      "ã‚‚ã—ä¸€é€±é–“â€œç¾é‡‘ã®ã¿ç”Ÿæ´»â€ã—ãŸã‚‰ã©ã†ã™ã‚‹ï¼Ÿ",
      "é€†ã«â€œã‚¹ãƒãƒ›ãªã—ç”Ÿæ´»â€ãªã‚‰ï¼Ÿ",
      "ã„ã¾æ¬²ã—ã„â€œå®¶é›»/ç”Ÿæ´»ãƒãƒƒã‚¯â€ã¯ï¼Ÿ",
      "å¥½ããªç¾è¡“é¤¨/æ°´æ—é¤¨/å‹•ç‰©åœ’ã®éã”ã—æ–¹",
      "ã€ã¾ãŸä¼šã„ãŸããªã‚‹äººã€ã®å…±é€šç‚¹ã£ã¦ï¼Ÿ"
    ],
    men: [
      "ä»Šå¹´â€œè²·ã£ã¦ã‚ˆã‹ã£ãŸâ€ã‚¬ã‚¸ã‚§ãƒƒãƒˆ/å·¥å…·ãƒ™ã‚¹ãƒˆ1",
      "æœ€å¼·ã®ãƒ©ãƒ¼ãƒ¡ãƒ³è«–äº‰ï¼ˆéººç¡¬ã•/æ²¹/å‘³ã®å¥½ã¿ï¼‰",
      "è»Šãƒ»ãƒã‚¤ã‚¯ãƒ»è‡ªè»¢è»Šã®ã“ã ã‚ã‚Šãƒã‚¤ãƒ³ãƒˆ",
      "ã‚­ãƒ£ãƒ³ãƒ—/ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢é“å…·ã®â€œæ²¼â€ã‚’èªã‚‹",
      "ä»•äº‹ã®ã—ãã˜ã‚Šã‹ã‚‰å­¦ã‚“ã â€œå†ç™ºé˜²æ­¢ãƒ¯ã‚¶â€",
      "å¥åº·è¨ºæ–­ã®æ•°å€¤ã‚’ã©ã†æ”¹å–„ã—ãŸï¼Ÿï¼ˆç„¡ç†ã®ãªã„ç¯„å›²ã§ï¼‰",
      "æ­´ä»£ã‚²ãƒ¼ãƒ æ©Ÿãƒ™ã‚¹ãƒˆ3ã¨æ€ã„å‡ºã®ä¸€æœ¬",
      "ã‚³ã‚¹ãƒ‘æœ€å¼·ã®é…’ï¼†ã¤ã¾ã¿ï¼ˆå®¶/å¤–ã§åˆ†ã‘ã¦ã‚‚OKï¼‰",
      "ã‚´ãƒ«ãƒ•ãƒ»é‡£ã‚Šãƒ»ã‚µã‚¦ãƒŠã€ãã‚Œãã‚Œã®â€œæ²¼ãƒã‚¤ãƒ³ãƒˆâ€",
      "ç­‹ãƒˆãƒ¬/ãƒ€ã‚¤ã‚¨ãƒƒãƒˆã‚ã‚‹ã‚ã‚‹ï¼†ç¶™ç¶šã‚³ãƒ„",
      "ãŠé‡‘ã®å¤±æ•—è«‡ã¨å­¦ã³ï¼ˆå…·ä½“é¡ã¯ä¼ã›ã¦ï¼‰",
      "10å¹´å‰ã®è‡ªåˆ†ã«ä¸€è¨€ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã™ã‚‹ãªã‚‰ï¼Ÿ",
      "å¤§äººã«ãªã£ã¦ã‹ã‚‰å§‹ã‚ã¦è‰¯ã‹ã£ãŸç¿’ã„äº‹/è¶£å‘³",
      "è…•æ™‚è¨ˆ/ä¸‡å¹´ç­†/ãƒãƒƒã‚°â€¦â€œç›¸æ£’ã‚®ã‚¢â€ã®è©±",
      "ä»•äº‹åŠ¹ç‡åŒ–ã®è£ãƒ¯ã‚¶ï¼ˆã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ/ä»•çµ„ã¿åŒ–ï¼‰",
      "ã‚«ãƒ©ã‚ªã‚±åå…«ç•ªï¼†ç››ã‚Šä¸Šã’æ–¹ã®ã‚³ãƒ„",
      "æ—…ã®ã“ã ã‚ã‚Šï¼ˆè·ç‰©/å®¿/ç§»å‹•ã®æœ€é©è§£ï¼‰",
      "ç”ºä¸­è¯ãƒ™ã‚¹ãƒˆã‚ªãƒ¼ãƒ€ãƒ¼ã‚’èªã‚‹",
      "å­ã©ã‚‚ã®é ƒã®ãƒ’ãƒ¼ãƒ­ãƒ¼/æˆ¦éšŠ/ã‚¹ãƒãƒ¼ãƒ„é¸æ‰‹",
      "ã‚‚ã—è‡ªåˆ†ãŒç¤¾é•·ãªã‚‰â€œåˆæ—¥ã«ã‚„ã‚‹ã“ã¨â€",
      "è¦³æˆ¦ã—ã¦éœ‡ãˆãŸã‚¹ãƒãƒ¼ãƒ„ã®è©¦åˆã‚’ä¸€ã¤",
      "â€œä¸€åº¦ã¯è¡ŒããŸã„â€å¤§äººã®é è¶³ãƒ—ãƒ©ãƒ³",
      "ä»•äº‹é“å…·ã®æœ€é©åŒ–ï¼ˆæ¤…å­/ãƒ¢ãƒ‹ã‚¿/ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ç­‰ï¼‰",
      "æœ€é«˜ã®æœã”ã¯ã‚“/å¤œé£Ÿã®ä½œã‚Šæ–¹",
      "æ™‚é–“ã¨ãŠé‡‘ã€ã©ã£ã¡ãŒè²´é‡ï¼Ÿç†ç”±ã¯ï¼Ÿ",
      "â€œèªã‚Šåˆãˆã‚‹ãƒãƒ¼/å±…é…’å±‹â€ã®æ¡ä»¶",
      "å®¶ã®åç´ãƒ»ã‚¬ãƒ¬ãƒ¼ã‚¸ã®å·¥å¤«ã€è¦‹ã›ã‚‰ã‚Œã‚‹ç¯„å›²ã§",
      "å¥½ããªè·äººæŠ€YouTube/ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ã‚¿ãƒªãƒ¼",
      "ã€äººç”Ÿã§ä¸€ç•ªåˆºã•ã£ãŸåè¨€ã€ã‚’èªã‚‹",
      "å¤±æ•—æ–™ç†ãƒ™ã‚¹ãƒˆï¼ˆãƒ¯ãƒ¼ã‚¹ãƒˆï¼‰ã¨ãƒªãƒ™ãƒ³ã‚¸æ–¹æ³•"
    ]
  };

  const FOLLOWUP_POOL = [
    "ãã‚Œã£ã¦â€œã„ã¤ãƒ»ã©ã“ã§â€ï¼Ÿ",
    "ä¸€ç•ªåˆºã•ã£ãŸãƒã‚¤ãƒ³ãƒˆã¯ã©ã“ï¼Ÿ",
    "åˆå¿ƒè€…ã«å‹§ã‚ã‚‹ãªã‚‰â€œä¸€è¨€ã§â€ã©ã†è¨€ã†ï¼Ÿ",
    "ãã®æ™‚ã®å†™çœŸã‚„ã‚¹ã‚¯ã‚·ãƒ§ã‚ã‚‹ï¼Ÿ",
    "ãƒãƒã£ãŸâ€œãã£ã‹ã‘â€ã¯ï¼Ÿ",
    "çœŸä¼¼ã™ã‚‹ãªã‚‰â€œæœ€åˆã®ä¸€æ­©â€ã¯ï¼Ÿ",
    "ãŠã™ã™ã‚â€œ3æŠâ€ã«ã™ã‚‹ã¨ï¼Ÿ",
    "ãã‚Œã®â€œæ„å¤–ãªè½ã¨ã—ç©´â€ã¯ï¼Ÿ",
    "æ¬¡ã«ã‚„ã‚‹ãªã‚‰ä½•ã™ã‚‹ï¼Ÿ"
  ];

  // ====== çŠ¶æ…‹ç®¡ç† ======
  let mode = "mixed";
  let deck = [];
  let history = [];

  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  const $ = (sel) => document.querySelector(sel);
  const toast = (msg) => {
    const el = $("#toast"); el.textContent = msg; el.classList.add("show");
    setTimeout(()=>el.classList.remove("show"), 1400);
  };
  const shuffle = (arr) => {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  };

  const buildDeck = () => {
    const N = DATA[mode].length;
    deck = shuffle([...Array(N).keys()]);
    updateProgress();
  };

  const updateProgress = () => {
    const total = DATA[mode].length;
    const used = history.filter(h=>h.mode===mode).length;
    $("#progress").textContent = `æ®‹ã‚Š ${Math.max(total - used, 0)} / å…¨${total}`;
  };

  const pickFollowups = (n=3) => shuffle(FOLLOWUP_POOL).slice(0,n);

  const render = (topicText) => {
    const topic = $("#topic");
    topic.textContent = topicText;
    topic.classList.remove("roll");
    // æ¬¡ãƒ•ãƒ¬ãƒ¼ãƒ ã§ä»˜ã‘ç›´ã—ã€ã‚¢ãƒ‹ãƒ¡ã‚’å†ç”Ÿ
    requestAnimationFrame(()=>topic.classList.add("roll"));

    const ul = $("#followups");
    ul.innerHTML = "";
    pickFollowups().forEach(q => {
      const li = document.createElement("li");
      li.textContent = "ãƒ»" + q;
      ul.appendChild(li);
    });
  };

  const pushHistory = (topicText) => {
    history.push({mode, topic: topicText, ts: Date.now()});
    // ç”»é¢ã®å±¥æ­´ã«ã‚‚è¿½åŠ 
    const ol = $("#history");
    const li = document.createElement("li");
    const d = new Date();
    const t = d.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
    li.textContent = `[${t}] ${topicText}`;
    ol.prepend(li);
    updateProgress();
    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜
    sessionStorage.setItem("nm_history", JSON.stringify(history));
  };

  const draw = () => {
    if (deck.length === 0) {
      buildDeck();
      toast("ä¸€å·¡ã—ãŸã®ã§ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¾ã—ãŸ");
    }
    const idx = deck.pop();
    const topicText = DATA[mode][idx];
    render(topicText);
    pushHistory(topicText);
    $("#modeTag").textContent = (mode==="mixed") ? "ç”·å¥³æ··åˆ" : "ç”·æ€§ã®ã¿";
    if (navigator.vibrate) { navigator.vibrate(12); }
  };

  const copyCurrent = async () => {
    const t = $("#topic").textContent;
    const follow = [...document.querySelectorAll("#followups li")].map(li=>li.textContent).join("\n");
    const text = `ã€${(mode==="mixed")?"ç”·å¥³æ··åˆ":"ç”·æ€§ã®ã¿"}ã€‘\nãŠé¡Œï¼š${t}\n${follow}`;
    try{
      await navigator.clipboard.writeText(text);
      toast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
    }catch(e){
      // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ä¸å¯ã®ç’°å¢ƒå‘ã‘ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      const ta = document.createElement("textarea");
      ta.value = text; document.body.appendChild(ta); ta.select();
      document.execCommand("copy"); document.body.removeChild(ta);
      toast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
    }
  };

  const resetAll = () => {
    buildDeck();
    $("#history").innerHTML = "";
    history = history.filter(h => h.mode !== mode); // ç¾åœ¨ãƒ¢ãƒ¼ãƒ‰ã®å±¥æ­´ã‚’ã‚¯ãƒªã‚¢
    sessionStorage.setItem("nm_history", JSON.stringify(history));
    toast("ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¾ã—ãŸ");
    updateProgress();
  };

  // ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
  document.querySelectorAll('input[name="mode"]').forEach(r => {
    r.addEventListener("change", (e) => {
      mode = e.target.value;
      $("#modeTag").textContent = (mode==="mixed") ? "ç”·å¥³æ··åˆ" : "ç”·æ€§ã®ã¿";
      buildDeck();
      updateProgress();
      // ç¾åœ¨ãƒ¢ãƒ¼ãƒ‰ã®æœ€åˆã®1æšã‚’è‡ªå‹•è¡¨ç¤º
      draw();
    });
  });
  $("#nextBtn").addEventListener("click", draw);
  $("#copyBtn").addEventListener("click", copyCurrent);
  $("#resetBtn").addEventListener("click", resetAll);

  // å¾©å…ƒ & åˆæœŸè¡¨ç¤º
  (function init(){
    try {
      const saved = sessionStorage.getItem("nm_history");
      if (saved) {
        history = JSON.parse(saved) || [];
      }
    } catch(_) {}
    buildDeck();
    draw();
  })();
</script>
</body>
</html>
"""
with open("/mnt/data/nomikai-topic-app.html", "w", encoding="utf-8") as f:
    f.write(content)
"/mnt/data/nomikai-topic-app.html"
