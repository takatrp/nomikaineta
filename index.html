<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ãƒ‘ã‚¹ã‚¿ãƒ»ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ï¼ˆã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—ä»˜ãï¼‰</title>
<style>
  :root{
    --brand:#578899; /* ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼ */
    --brand-dark:#3f6773;
    --ink:#1e2a2f;
    --muted:#6b7c86;
    --bg:#f5f7f9;
    --card:#ffffff;
    --good:#0a7f3f;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Hiragino Kaku Gothic ProN','Noto Sans JP','Yu Gothic',Meiryo,sans-serif;}
  .wrap{max-width:980px;margin:0 auto;padding:16px;}
  .title{font-size: clamp(18px, 3.6vw, 28px);font-weight:700;margin:6px 0 12px;letter-spacing:.02em;}
  .subtitle{color:var(--muted);margin:0 0 18px;font-size:14px}
  .grid{display:grid;gap:12px;grid-template-columns: 1fr;}
  @media(min-width:860px){ .grid{grid-template-columns: 1.2fr 1fr;} }
  .card{background:var(--card);border-radius:14px;box-shadow: 0 2px 12px rgba(0,0,0,.06);padding:14px;}
  .card h2{font-size:16px;margin:0 0 10px;color:var(--brand-dark)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:8px 0}
  label{font-size:13px;color:var(--muted)}
  input[type="number"], select{
    appearance:none;
    border:1px solid #d6dde3;border-radius:10px;
    padding:10px 12px;font-size:16px;background:#fff;min-width:90px;
  }
  input[type="range"]{width:180px}
  .btn{
    border:0;border-radius:12px;padding:12px 16px;font-weight:700;
    background:var(--brand);color:#fff;cursor:pointer;transition: transform .03s ease, filter .15s;
  }
  .btn:hover{filter:brightness(1.08)}
  .btn:active{transform: translateY(1px)}
  .btn.secondary{background:#e9eef2;color:#1c2b33;font-weight:650}
  .btn.ghost{background:transparent;border:1px solid #c7d1d8;color:#2a3a41}
  .pill{display:inline-block;background:#eef4f7;border-radius:999px;padding:.2em .7em;font-size:12px;color:#40606c;margin-left:6px}
  .kpi{display:flex;gap:10px;align-items:baseline;flex-wrap:wrap}
  .kpi .big{font-size: clamp(26px, 6vw, 40px);font-weight:800;color:var(--brand-dark)}
  .kpi .unit{color:var(--muted)}
  .list{max-height:420px;overflow:auto;border:1px dashed #d5dfe6;border-radius:12px;padding:6px}
  table{border-collapse:collapse;width:100%}
  th,td{padding:8px 6px;border-bottom:1px solid #eef1f4;font-size:14px}
  th{position:sticky;top:0;background:#f3f7fa;font-weight:700}
  .right{text-align:right}
  .muted{color:var(--muted)}
  .tag{display:inline-block;border:1px solid #d7e2e7;border-radius:999px;padding:.2em .7em;font-size:12px;margin:2px}
  .breakdown{font-size:14px;line-height:1.7}
  .footer{margin-top:14px;font-size:12px;color:#6c7a82;text-align:center}
  .divider{height:1px;background:#e8eef2;margin:10px 0}
  .badge{background:#eff9f2;color:var(--good);font-weight:700;padding:.25em .6em;border-radius:999px;font-size:12px}
  .flex{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .nowrap{white-space:nowrap}
</style>
</head>
<body>
  <div class="wrap">
    <div class="title">ãƒ‘ã‚¹ã‚¿ãƒ»ãƒ©ãƒ³ãƒ€ãƒ ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ï¼ˆã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—ä»˜ãï¼‰</div>
    <div class="subtitle">ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ã§ãƒ‘ã‚¹ã‚¿ï¼†ãƒˆãƒƒãƒ”ãƒ³ã‚°ã‚’ãƒ©ãƒ³ãƒ€ãƒ é¸æŠã€‚ç·¨é›†å¯èƒ½ãªã‚«ãƒ­ãƒªãƒ¼ã§åˆè¨ˆå€¤ã‚’å³æ™‚è¨ˆç®—ã—ã¾ã™ï¼ˆæ¦‚ç®—ï¼‰ã€‚</div>

    <div class="grid">
      <!-- Left: Controls -->
      <div class="card">
        <h2>â‘  åŸºæœ¬è¨­å®š</h2>
        <div class="row">
          <div class="flex">
            <label class="nowrap">ãƒ‘ã‚¹ã‚¿ã®ç¨®é¡</label>
            <span id="pastaName" class="tag">æœªé¸æŠ</span>
            <button class="btn secondary" id="randomBtn">ğŸ² ãƒ©ãƒ³ãƒ€ãƒ é¸æŠ</button>
            <button class="btn ghost" id="rerollToppingsBtn">ğŸ” ãƒˆãƒƒãƒ”ãƒ³ã‚°ã ã‘å†æŠ½é¸</button>
          </div>
        </div>
        <div class="row">
          <label>ã‚†ã§ä¸ŠãŒã‚Šé‡ï¼ˆgï¼‰</label>
          <input type="number" id="grams" value="180" min="50" max="600" step="10" />
          <label>ã‚«ãƒ­ãƒªãƒ¼ï¼ˆ100gã‚ãŸã‚Šï¼‰</label>
          <input type="number" id="kcalPer100" value="160" min="50" max="300" step="1" />
          <span class="pill">ç·¨é›†å¯</span>
        </div>

        <div class="divider"></div>

        <h2>â‘¡ ãƒˆãƒƒãƒ”ãƒ³ã‚°ï¼ˆç·¨é›†å¯ï¼‰</h2>
        <div class="row">
          <label>ãƒ©ãƒ³ãƒ€ãƒ é¸æŠã™ã‚‹å€‹æ•°ï¼š</label>
          <input type="range" id="randCount" min="0" max="5" value="2" />
          <span class="badge"><span id="randCountLabel">2</span> å€‹</span>
          <button class="btn ghost" id="clearAllBtn">å…¨ã¦å¤–ã™</button>
        </div>

        <div class="list">
          <table>
            <thead>
              <tr>
                <th style="width:38px">é¸æŠ</th>
                <th>ãƒˆãƒƒãƒ”ãƒ³ã‚°</th>
                <th class="right" style="width:140px">ã‚«ãƒ­ãƒªãƒ¼ï¼ˆ1é£Ÿåˆ†ï¼‰</th>
              </tr>
            </thead>
            <tbody id="toppingRows"></tbody>
          </table>
        </div>

        <div class="row">
          <button class="btn secondary" id="addRowBtn">ï¼‹ ãƒˆãƒƒãƒ”ãƒ³ã‚°ã‚’è¿½åŠ </button>
        </div>
      </div>

      <!-- Right: Result -->
      <div class="card" id="resultCard">
        <h2>â‘¢ çµæœ</h2>
        <div class="kpi">
          <div class="big" id="totalKcal">0</div>
          <div class="unit">kcal / 1é£Ÿ</div>
        </div>
        <div class="breakdown" id="breakdown"></div>
        <div class="row">
          <button class="btn" id="copyBtn">ã‚³ãƒ”ãƒ¼</button>
          <button class="btn ghost" id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>

        <div class="divider"></div>
        <div class="muted" style="font-size:12px">
          â€» ã‚«ãƒ­ãƒªãƒ¼ã¯æ¦‚ç®—ã§ã™ã€‚å€¤ã¯é£Ÿæã‚„èª¿ç†æ–¹æ³•ã§å¤§ããå¤‰ã‚ã‚Šã¾ã™ã€‚å¿…è¦ã«å¿œã˜ã¦å„æ•°å€¤ã‚’ç·¨é›†ã—ã¦ãã ã•ã„ã€‚
        </div>
      </div>
    </div>

    <div class="footer">v1.0 / 2025-08-27 â€” Â© Matsumoto Kaikei Tools</div>
  </div>

<script>
(() => {
  // ---- Pasta shapes ----
  const PASTA_SHAPES = [
    "ã‚¹ãƒ‘ã‚²ãƒƒãƒ†ã‚£","ãƒªãƒ³ã‚°ã‚¤ãƒ","ãƒ•ã‚§ãƒƒãƒˆãƒãƒ¼ãƒ","ã‚¿ãƒªã‚¢ãƒ†ãƒƒãƒ¬","ã‚«ãƒƒãƒšãƒªãƒ¼ãƒ‹",
    "ãƒ–ã‚«ãƒ†ã‚£ãƒ¼ãƒ‹","ãƒšãƒ³ãƒ","ãƒ•ã‚¸ãƒƒãƒª","ã‚³ãƒ³ã‚­ãƒªã‚¨","ãƒªã‚¬ãƒˆãƒ¼ãƒ‹","ã‚ªãƒ¬ã‚­ã‚¨ãƒƒãƒ†",
    "ãƒ•ã‚¡ãƒ«ãƒ•ã‚¡ãƒƒãƒ¬","ãƒ‹ãƒ§ãƒƒã‚­ï¼ˆã˜ã‚ƒãŒã„ã‚‚ï¼‰","ãƒ©ã‚¶ãƒ‹ã‚¢ï¼ˆæ¿ï¼‰"
  ];

  // ---- Default toppings (name, kcal per serving) ----
  const DEFAULT_TOPPINGS = [
    ["ã‚ªãƒªãƒ¼ãƒ–ã‚ªã‚¤ãƒ«ï¼ˆå¤§ã•ã˜1ï¼‰", 120],
    ["ç²‰ãƒãƒ¼ã‚º/ãƒ‘ãƒ«ãƒ¡ã‚¶ãƒ³ï¼ˆå¤§ã•ã˜2ãƒ»ç´„16gï¼‰", 80],
    ["ãƒ™ãƒ¼ã‚³ãƒ³ï¼ˆ2æšãƒ»ç´„30gï¼‰", 120],
    ["é¶ã‚€ã­ç…§ã‚Šç„¼ãï¼ˆ50gï¼‰", 110],
    ["ã‚¨ãƒ“ï¼ˆ50gï¼‰", 60],
    ["ãƒ„ãƒŠï¼ˆæ°´ç…®1/2ç¼¶ï¼‰", 70],
    ["ãã®ã“ã‚½ãƒ†ãƒ¼ï¼ˆ80gï¼‰", 35],
    ["ã«ã‚“ã«ãï¼ˆ1ç‰‡ï¼‰", 10],
    ["ãƒˆãƒãƒˆã‚½ãƒ¼ã‚¹ï¼ˆ1/2ã‚«ãƒƒãƒ—ï¼‰", 80],
    ["ã‚¯ãƒªãƒ¼ãƒ ã‚½ãƒ¼ã‚¹ï¼ˆ1/2ã‚«ãƒƒãƒ—ï¼‰", 200],
    ["ãƒšã‚¹ãƒˆï¼ˆã‚¸ã‚§ãƒãƒ™ãƒ¼ã‚¼ 1/4ã‚«ãƒƒãƒ—ï¼‰", 240],
    ["ãƒã‚¿ãƒ¼ï¼ˆ10gï¼‰", 75],
    ["æ˜å¤ªå­ï¼ˆ25gï¼‰", 40],
    ["æµ·è‹”ï¼ˆé©é‡ï¼‰", 5],
  ];

  // ---- State ----
  const el = {
    pastaName: document.getElementById('pastaName'),
    grams: document.getElementById('grams'),
    kcalPer100: document.getElementById('kcalPer100'),
    toppingRows: document.getElementById('toppingRows'),
    totalKcal: document.getElementById('totalKcal'),
    breakdown: document.getElementById('breakdown'),
    randCount: document.getElementById('randCount'),
    randCountLabel: document.getElementById('randCountLabel'),
    clearAllBtn: document.getElementById('clearAllBtn'),
    addRowBtn: document.getElementById('addRowBtn'),
    randomBtn: document.getElementById('randomBtn'),
    rerollToppingsBtn: document.getElementById('rerollToppingsBtn'),
    copyBtn: document.getElementById('copyBtn'),
    resetBtn: document.getElementById('resetBtn'),
  };

  function makeRow(name, kcal, checked=false){
    const tr = document.createElement('tr');

    const tdCheck = document.createElement('td');
    const cb = document.createElement('input');
    cb.type = 'checkbox';
    cb.checked = checked;
    cb.addEventListener('change', calc);
    tdCheck.appendChild(cb);

    const tdName = document.createElement('td');
    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.value = name;
    nameInput.style.width = '100%';
    nameInput.addEventListener('input', calc);
    tdName.appendChild(nameInput);

    const tdKcal = document.createElement('td');
    tdKcal.className = 'right';
    const kcalInput = document.createElement('input');
    kcalInput.type = 'number';
    kcalInput.min = '0';
    kcalInput.step = '1';
    kcalInput.value = kcal;
    kcalInput.style.textAlign = 'right';
    kcalInput.style.width = '110px';
    kcalInput.addEventListener('input', calc);
    tdKcal.appendChild(kcalInput);

    tr.appendChild(tdCheck);
    tr.appendChild(tdName);
    tr.appendChild(tdKcal);
    return tr;
  }

  function initToppings(){
    el.toppingRows.innerHTML = '';
    DEFAULT_TOPPINGS.forEach(([n,k]) => el.toppingRows.appendChild(makeRow(n,k,false)));
  }

  function pickRandomPasta(){
    const idx = Math.floor(Math.random() * PASTA_SHAPES.length);
    const name = PASTA_SHAPES[idx];
    el.pastaName.textContent = name;
  }

  function pickRandomToppings(count){
    const rows = Array.from(el.toppingRows.querySelectorAll('tr'));
    rows.forEach(r => r.querySelector('input[type="checkbox"]').checked = false);
    // Fisher-Yates shuffle
    const indices = rows.map((_,i)=>i);
    for(let i=indices.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [indices[i],indices[j]] = [indices[j],indices[i]];
    }
    indices.slice(0, Math.min(count, rows.length)).forEach(i => {
      rows[i].querySelector('input[type="checkbox"]').checked = true;
    });
  }

  function format(num){
    return Math.round(num).toLocaleString('ja-JP');
  }

  function calc(){
    const grams = Number(el.grams.value || 0);
    const kcal100 = Number(el.kcalPer100.value || 0);
    const base = grams * kcal100 / 100;

    let tops = [];
    let topsSum = 0;
    el.toppingRows.querySelectorAll('tr').forEach(tr => {
      const cb = tr.querySelector('input[type="checkbox"]');
      const name = tr.querySelector('input[type="text"]').value.trim() || 'ãƒˆãƒƒãƒ”ãƒ³ã‚°';
      const kcal = Number(tr.querySelector('input[type="number"]').value || 0);
      if(cb.checked){
        tops.push({name, kcal});
        topsSum += kcal;
      }
    });

    const total = base + topsSum;

    // KPI
    el.totalKcal.textContent = format(total);

    // Breakdown
    const pastaN = el.pastaName.textContent || 'ï¼ˆæœªé¸æŠã®ãƒ‘ã‚¹ã‚¿ï¼‰';
    let html = `
      <div><strong>${pastaN}</strong>ï¼š${format(base)} kcalï¼ˆ${format(grams)}g Ã— ${format(kcal100)} kcal/100gï¼‰</div>
    `;
    if(tops.length){
      html += `<div style="margin-top:6px"><strong>ãƒˆãƒƒãƒ”ãƒ³ã‚°</strong>ï¼š</div>`;
      tops.forEach(t => html += `<div>ãƒ»${escapeHtml(t.name)} â€¦ ${format(t.kcal)} kcal</div>`);
      html += `<div class="divider"></div>`;
      html += `<div>ãƒˆãƒƒãƒ”ãƒ³ã‚°å°è¨ˆï¼š<strong>${format(topsSum)}</strong> kcal</div>`;
    }else{
      html += `<div class="muted" style="margin-top:6px">â€» ãƒˆãƒƒãƒ”ãƒ³ã‚°ãŒæœªé¸æŠã§ã™</div>`;
    }
    document.getElementById('breakdown').innerHTML = html;
  }

  function escapeHtml(str){
    return str.replace(/[&<>"']/g, m => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[m]));
  }

  function copyResult(){
    const grams = Number(el.grams.value || 0);
    const kcal100 = Number(el.kcalPer100.value || 0);
    const base = grams * kcal100 / 100;
    const pastaN = el.pastaName.textContent || 'ï¼ˆæœªé¸æŠã®ãƒ‘ã‚¹ã‚¿ï¼‰';
    let lines = [];
    lines.push(`æœ¬æ—¥ã®ãƒ‘ã‚¹ã‚¿ï¼š${pastaN}`);
    lines.push(`ã‚†ã§ä¸ŠãŒã‚Šé‡ï¼š${grams}gï¼ˆ${kcal100}kcal/100gï¼‰`);
    // toppings
    let tops = [];
    el.toppingRows.querySelectorAll('tr').forEach(tr => {
      const cb = tr.querySelector('input[type="checkbox"]');
      if(cb.checked){
        const name = tr.querySelector('input[type="text"]').value.trim() || 'ãƒˆãƒƒãƒ”ãƒ³ã‚°';
        const kcal = Number(tr.querySelector('input[type="number"]').value || 0);
        tops.push({name,kcal});
      }
    });
    if(tops.length){
      lines.push('ãƒˆãƒƒãƒ”ãƒ³ã‚°ï¼š');
      tops.forEach(t => lines.push(`ãƒ»${t.name} â€¦ ${t.kcal} kcal`));
      const sum = tops.reduce((a,b)=>a+b.kcal,0);
      lines.push(`ãƒˆãƒƒãƒ”ãƒ³ã‚°å°è¨ˆï¼š${sum} kcal`);
    }else{
      lines.push('ãƒˆãƒƒãƒ”ãƒ³ã‚°ï¼šãªã—');
    }
    const total = Math.round(base + (tops.reduce((a,b)=>a+b.kcal,0)));
    lines.push(`åˆè¨ˆï¼š${total} kcal`);
    const text = lines.join('\n');

    navigator.clipboard.writeText(text).then(()=>{
      const original = el.copyBtn.textContent;
      el.copyBtn.textContent = 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ âœ”';
      setTimeout(()=> el.copyBtn.textContent = original, 1400);
    }).catch(()=>{
      alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
    });
  }

  function resetAll(){
    el.pastaName.textContent = 'æœªé¸æŠ';
    el.grams.value = 180;
    el.kcalPer100.value = 160;
    initToppings();
    calc();
  }

  // ---- Event wiring ----
  el.randCount.addEventListener('input', () => {
    el.randCountLabel.textContent = el.randCount.value;
  });

  el.randomBtn.addEventListener('click', () => {
    pickRandomPasta();
    const n = Number(el.randCount.value || 0);
    pickRandomToppings(n);
    calc();
  });

  el.rerollToppingsBtn.addEventListener('click', () => {
    const n = Number(el.randCount.value || 0);
    pickRandomToppings(n);
    calc();
  });

  el.clearAllBtn.addEventListener('click', () => {
    el.toppingRows.querySelectorAll('tr input[type="checkbox"]').forEach(cb => cb.checked = false);
    calc();
  });

  el.addRowBtn.addEventListener('click', () => {
    el.toppingRows.appendChild(makeRow('ï¼ˆæ–°è¦ãƒˆãƒƒãƒ”ãƒ³ã‚°ï¼‰', 0, false));
    el.toppingRows.scrollTop = el.toppingRows.scrollHeight;
  });

  el.copyBtn.addEventListener('click', copyResult);
  el.resetBtn.addEventListener('click', resetAll);

  el.grams.addEventListener('input', calc);
  el.kcalPer100.addEventListener('input', calc);

  // ---- Boot ----
  initToppings();
  calc();
})();
</script>
</body>
</html>