<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>パスタ・ランダムセレクター（カロリー計算付き）</title>
<style>
  :root{
    --brand:#578899; /* ベースカラー */
    --brand-dark:#3f6773;
    --ink:#1e2a2f;
    --muted:#6b7c86;
    --bg:#f5f7f9;
    --card:#ffffff;
    --good:#0a7f3f;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Hiragino Kaku Gothic ProN','Noto Sans JP','Yu Gothic',Meiryo,sans-serif;}
  .wrap{max-width:980px;margin:0 auto;padding:16px;}
  .title{font-size: clamp(18px, 3.6vw, 28px);font-weight:700;margin:6px 0 12px;letter-spacing:.02em;}
  .subtitle{color:var(--muted);margin:0 0 18px;font-size:14px}
  .grid{display:grid;gap:12px;grid-template-columns: 1fr;}
  @media(min-width:860px){ .grid{grid-template-columns: 1.2fr 1fr;} }
  .card{background:var(--card);border-radius:14px;box-shadow: 0 2px 12px rgba(0,0,0,.06);padding:14px;}
  .card h2{font-size:16px;margin:0 0 10px;color:var(--brand-dark)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:8px 0}
  label{font-size:13px;color:var(--muted)}
  input[type="number"], select{
    appearance:none;
    border:1px solid #d6dde3;border-radius:10px;
    padding:10px 12px;font-size:16px;background:#fff;min-width:90px;
  }
  input[type="range"]{width:180px}
  .btn{
    border:0;border-radius:12px;padding:12px 16px;font-weight:700;
    background:var(--brand);color:#fff;cursor:pointer;transition: transform .03s ease, filter .15s;
  }
  .btn:hover{filter:brightness(1.08)}
  .btn:active{transform: translateY(1px)}
  .btn.secondary{background:#e9eef2;color:#1c2b33;font-weight:650}
  .btn.ghost{background:transparent;border:1px solid #c7d1d8;color:#2a3a41}
  .pill{display:inline-block;background:#eef4f7;border-radius:999px;padding:.2em .7em;font-size:12px;color:#40606c;margin-left:6px}
  .kpi{display:flex;gap:10px;align-items:baseline;flex-wrap:wrap}
  .kpi .big{font-size: clamp(26px, 6vw, 40px);font-weight:800;color:var(--brand-dark)}
  .kpi .unit{color:var(--muted)}
  .list{max-height:420px;overflow:auto;border:1px dashed #d5dfe6;border-radius:12px;padding:6px}
  table{border-collapse:collapse;width:100%}
  th,td{padding:8px 6px;border-bottom:1px solid #eef1f4;font-size:14px}
  th{position:sticky;top:0;background:#f3f7fa;font-weight:700}
  .right{text-align:right}
  .muted{color:var(--muted)}
  .tag{display:inline-block;border:1px solid #d7e2e7;border-radius:999px;padding:.2em .7em;font-size:12px;margin:2px}
  .breakdown{font-size:14px;line-height:1.7}
  .footer{margin-top:14px;font-size:12px;color:#6c7a82;text-align:center}
  .divider{height:1px;background:#e8eef2;margin:10px 0}
  .badge{background:#eff9f2;color:var(--good);font-weight:700;padding:.25em .6em;border-radius:999px;font-size:12px}
  .flex{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .nowrap{white-space:nowrap}
</style>
</head>
<body>
  <div class="wrap">
    <div class="title">パスタ・ランダムセレクター（カロリー計算付き）</div>
    <div class="subtitle">ワンタップでパスタ＆トッピングをランダム選択。編集可能なカロリーで合計値を即時計算します（概算）。</div>

    <div class="grid">
      <!-- Left: Controls -->
      <div class="card">
        <h2>① 基本設定</h2>
        <div class="row">
          <div class="flex">
            <label class="nowrap">パスタの種類</label>
            <span id="pastaName" class="tag">未選択</span>
            <button class="btn secondary" id="randomBtn">🎲 ランダム選択</button>
            <button class="btn ghost" id="rerollToppingsBtn">🔁 トッピングだけ再抽選</button>
          </div>
        </div>
        <div class="row">
          <label>ゆで上がり量（g）</label>
          <input type="number" id="grams" value="180" min="50" max="600" step="10" />
          <label>カロリー（100gあたり）</label>
          <input type="number" id="kcalPer100" value="160" min="50" max="300" step="1" />
          <span class="pill">編集可</span>
        </div>

        <div class="divider"></div>

        <h2>② トッピング（編集可）</h2>
        <div class="row">
          <label>ランダム選択する個数：</label>
          <input type="range" id="randCount" min="0" max="5" value="2" />
          <span class="badge"><span id="randCountLabel">2</span> 個</span>
          <button class="btn ghost" id="clearAllBtn">全て外す</button>
        </div>

        <div class="list">
          <table>
            <thead>
              <tr>
                <th style="width:38px">選択</th>
                <th>トッピング</th>
                <th class="right" style="width:140px">カロリー（1食分）</th>
              </tr>
            </thead>
            <tbody id="toppingRows"></tbody>
          </table>
        </div>

        <div class="row">
          <button class="btn secondary" id="addRowBtn">＋ トッピングを追加</button>
        </div>
      </div>

      <!-- Right: Result -->
      <div class="card" id="resultCard">
        <h2>③ 結果</h2>
        <div class="kpi">
          <div class="big" id="totalKcal">0</div>
          <div class="unit">kcal / 1食</div>
        </div>
        <div class="breakdown" id="breakdown"></div>
        <div class="row">
          <button class="btn" id="copyBtn">コピー</button>
          <button class="btn ghost" id="resetBtn">リセット</button>
        </div>

        <div class="divider"></div>
        <div class="muted" style="font-size:12px">
          ※ カロリーは概算です。値は食材や調理方法で大きく変わります。必要に応じて各数値を編集してください。
        </div>
      </div>
    </div>

    <div class="footer">v1.0 / 2025-08-27 — © Matsumoto Kaikei Tools</div>
  </div>

<script>
(() => {
  // ---- Pasta shapes ----
  const PASTA_SHAPES = [
    "スパゲッティ","リングイネ","フェットチーネ","タリアテッレ","カッペリーニ",
    "ブカティーニ","ペンネ","フジッリ","コンキリエ","リガトーニ","オレキエッテ",
    "ファルファッレ","ニョッキ（じゃがいも）","ラザニア（板）"
  ];

  // ---- Default toppings (name, kcal per serving) ----
  const DEFAULT_TOPPINGS = [
    ["オリーブオイル（大さじ1）", 120],
    ["粉チーズ/パルメザン（大さじ2・約16g）", 80],
    ["ベーコン（2枚・約30g）", 120],
    ["鶏むね照り焼き（50g）", 110],
    ["エビ（50g）", 60],
    ["ツナ（水煮1/2缶）", 70],
    ["きのこソテー（80g）", 35],
    ["にんにく（1片）", 10],
    ["トマトソース（1/2カップ）", 80],
    ["クリームソース（1/2カップ）", 200],
    ["ペスト（ジェノベーゼ 1/4カップ）", 240],
    ["バター（10g）", 75],
    ["明太子（25g）", 40],
    ["海苔（適量）", 5],
  ];

  // ---- State ----
  const el = {
    pastaName: document.getElementById('pastaName'),
    grams: document.getElementById('grams'),
    kcalPer100: document.getElementById('kcalPer100'),
    toppingRows: document.getElementById('toppingRows'),
    totalKcal: document.getElementById('totalKcal'),
    breakdown: document.getElementById('breakdown'),
    randCount: document.getElementById('randCount'),
    randCountLabel: document.getElementById('randCountLabel'),
    clearAllBtn: document.getElementById('clearAllBtn'),
    addRowBtn: document.getElementById('addRowBtn'),
    randomBtn: document.getElementById('randomBtn'),
    rerollToppingsBtn: document.getElementById('rerollToppingsBtn'),
    copyBtn: document.getElementById('copyBtn'),
    resetBtn: document.getElementById('resetBtn'),
  };

  function makeRow(name, kcal, checked=false){
    const tr = document.createElement('tr');

    const tdCheck = document.createElement('td');
    const cb = document.createElement('input');
    cb.type = 'checkbox';
    cb.checked = checked;
    cb.addEventListener('change', calc);
    tdCheck.appendChild(cb);

    const tdName = document.createElement('td');
    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.value = name;
    nameInput.style.width = '100%';
    nameInput.addEventListener('input', calc);
    tdName.appendChild(nameInput);

    const tdKcal = document.createElement('td');
    tdKcal.className = 'right';
    const kcalInput = document.createElement('input');
    kcalInput.type = 'number';
    kcalInput.min = '0';
    kcalInput.step = '1';
    kcalInput.value = kcal;
    kcalInput.style.textAlign = 'right';
    kcalInput.style.width = '110px';
    kcalInput.addEventListener('input', calc);
    tdKcal.appendChild(kcalInput);

    tr.appendChild(tdCheck);
    tr.appendChild(tdName);
    tr.appendChild(tdKcal);
    return tr;
  }

  function initToppings(){
    el.toppingRows.innerHTML = '';
    DEFAULT_TOPPINGS.forEach(([n,k]) => el.toppingRows.appendChild(makeRow(n,k,false)));
  }

  function pickRandomPasta(){
    const idx = Math.floor(Math.random() * PASTA_SHAPES.length);
    const name = PASTA_SHAPES[idx];
    el.pastaName.textContent = name;
  }

  function pickRandomToppings(count){
    const rows = Array.from(el.toppingRows.querySelectorAll('tr'));
    rows.forEach(r => r.querySelector('input[type="checkbox"]').checked = false);
    // Fisher-Yates shuffle
    const indices = rows.map((_,i)=>i);
    for(let i=indices.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [indices[i],indices[j]] = [indices[j],indices[i]];
    }
    indices.slice(0, Math.min(count, rows.length)).forEach(i => {
      rows[i].querySelector('input[type="checkbox"]').checked = true;
    });
  }

  function format(num){
    return Math.round(num).toLocaleString('ja-JP');
  }

  function calc(){
    const grams = Number(el.grams.value || 0);
    const kcal100 = Number(el.kcalPer100.value || 0);
    const base = grams * kcal100 / 100;

    let tops = [];
    let topsSum = 0;
    el.toppingRows.querySelectorAll('tr').forEach(tr => {
      const cb = tr.querySelector('input[type="checkbox"]');
      const name = tr.querySelector('input[type="text"]').value.trim() || 'トッピング';
      const kcal = Number(tr.querySelector('input[type="number"]').value || 0);
      if(cb.checked){
        tops.push({name, kcal});
        topsSum += kcal;
      }
    });

    const total = base + topsSum;

    // KPI
    el.totalKcal.textContent = format(total);

    // Breakdown
    const pastaN = el.pastaName.textContent || '（未選択のパスタ）';
    let html = `
      <div><strong>${pastaN}</strong>：${format(base)} kcal（${format(grams)}g × ${format(kcal100)} kcal/100g）</div>
    `;
    if(tops.length){
      html += `<div style="margin-top:6px"><strong>トッピング</strong>：</div>`;
      tops.forEach(t => html += `<div>・${escapeHtml(t.name)} … ${format(t.kcal)} kcal</div>`);
      html += `<div class="divider"></div>`;
      html += `<div>トッピング小計：<strong>${format(topsSum)}</strong> kcal</div>`;
    }else{
      html += `<div class="muted" style="margin-top:6px">※ トッピングが未選択です</div>`;
    }
    document.getElementById('breakdown').innerHTML = html;
  }

  function escapeHtml(str){
    return str.replace(/[&<>"']/g, m => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[m]));
  }

  function copyResult(){
    const grams = Number(el.grams.value || 0);
    const kcal100 = Number(el.kcalPer100.value || 0);
    const base = grams * kcal100 / 100;
    const pastaN = el.pastaName.textContent || '（未選択のパスタ）';
    let lines = [];
    lines.push(`本日のパスタ：${pastaN}`);
    lines.push(`ゆで上がり量：${grams}g（${kcal100}kcal/100g）`);
    // toppings
    let tops = [];
    el.toppingRows.querySelectorAll('tr').forEach(tr => {
      const cb = tr.querySelector('input[type="checkbox"]');
      if(cb.checked){
        const name = tr.querySelector('input[type="text"]').value.trim() || 'トッピング';
        const kcal = Number(tr.querySelector('input[type="number"]').value || 0);
        tops.push({name,kcal});
      }
    });
    if(tops.length){
      lines.push('トッピング：');
      tops.forEach(t => lines.push(`・${t.name} … ${t.kcal} kcal`));
      const sum = tops.reduce((a,b)=>a+b.kcal,0);
      lines.push(`トッピング小計：${sum} kcal`);
    }else{
      lines.push('トッピング：なし');
    }
    const total = Math.round(base + (tops.reduce((a,b)=>a+b.kcal,0)));
    lines.push(`合計：${total} kcal`);
    const text = lines.join('\n');

    navigator.clipboard.writeText(text).then(()=>{
      const original = el.copyBtn.textContent;
      el.copyBtn.textContent = 'コピーしました ✔';
      setTimeout(()=> el.copyBtn.textContent = original, 1400);
    }).catch(()=>{
      alert('コピーに失敗しました。');
    });
  }

  function resetAll(){
    el.pastaName.textContent = '未選択';
    el.grams.value = 180;
    el.kcalPer100.value = 160;
    initToppings();
    calc();
  }

  // ---- Event wiring ----
  el.randCount.addEventListener('input', () => {
    el.randCountLabel.textContent = el.randCount.value;
  });

  el.randomBtn.addEventListener('click', () => {
    pickRandomPasta();
    const n = Number(el.randCount.value || 0);
    pickRandomToppings(n);
    calc();
  });

  el.rerollToppingsBtn.addEventListener('click', () => {
    const n = Number(el.randCount.value || 0);
    pickRandomToppings(n);
    calc();
  });

  el.clearAllBtn.addEventListener('click', () => {
    el.toppingRows.querySelectorAll('tr input[type="checkbox"]').forEach(cb => cb.checked = false);
    calc();
  });

  el.addRowBtn.addEventListener('click', () => {
    el.toppingRows.appendChild(makeRow('（新規トッピング）', 0, false));
    el.toppingRows.scrollTop = el.toppingRows.scrollHeight;
  });

  el.copyBtn.addEventListener('click', copyResult);
  el.resetBtn.addEventListener('click', resetAll);

  el.grams.addEventListener('input', calc);
  el.kcalPer100.addEventListener('input', calc);

  // ---- Boot ----
  initToppings();
  calc();
})();
</script>
</body>
</html>